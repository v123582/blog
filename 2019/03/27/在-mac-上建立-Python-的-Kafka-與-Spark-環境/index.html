<!DOCTYPE html><html lang="zh-TW"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><meta property="og:image" content="https://avatars2.githubusercontent.com/u/5959524?v=3&amp;s=300"><meta property="og:description" content="WeiYuan Note | 在 mac 上建立 Python 的 Kafka 與 Spark 環境"><meta property="og:title" content="在 mac 上建立 Python 的 Kafka 與 Spark 環境"><title>在 mac 上建立 Python 的 Kafka 與 Spark 環境 | 資料科學家的工作日常</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/pure-min.css"><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css"><link rel="stylesheet" type="text/css" href="/css/profile-card.css"><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><link href="//cdn-images.mailchimp.com/embedcode/slim-10_7.css" rel="stylesheet" type="text/css"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script><!-- hexo-inject:begin --><!-- hexo-inject:end -->(adsbygoogle = window.adsbygoogle || []).push({
google_ad_client: "ca-pub-7913880396333307",
enable_page_level_ads: true
});


</script><!-- hexo-inject:begin --><!-- hexo-inject:end --></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">在 mac 上建立 Python 的 Kafka 與 Spark 環境</h1><a id="logo" href="https://v123582.github.io">資料科學家的工作日常</a><p class="description">#遠端 #斜槓 #教學 #資料科學 #網站開發</p></div><div id="nav-menu"><a href="https://v123582.github.io/about"><i class="icon-about"> 關於</i></a><a href="https://v123582.github.io/project"><i class="fa fa-tasks"> 專案</i></a><a href="https://v123582.github.io/blog"><i class="icon-archive"> 技術</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post post-page"><h1 class="post-title"><span><i class="fa fa-star"></i></span>在 mac 上建立 Python 的 Kafka 與 Spark 環境</h1><div class="post-meta">2019-03-27 | WeiYuan (@v123582)</div><a data-url="https://blog.v12358.tw/2019/03/27/在-mac-上建立-Python-的-Kafka-與-Spark-環境/" data-id="ckpthug62004f1ascftcfrq2i" class="article-share-link">Share</a><div class="post-content"><h2 id="introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>&#x300C;Producer-Consumer&#x300D;&#x554F;&#x984C;&#x662F;&#x8CC7;&#x5DE5;&#x7CFB;&#x5F88;&#x5E38;&#x7528;&#x4F86;&#x89E3;&#x91CB;&#x8A0A;&#x606F;&#x4EA4;&#x63DB;&#x7684;&#x4E00;&#x7A2E;&#x7BC4;&#x4F8B;&#xFF0C;&#x7528;&#x751F;&#x7522;&#x8005;&#x8DDF;&#x6D88;&#x8CBB;&#x8005;&#x9593;&#x7684;&#x95DC;&#x4FC2;&#x4F86;&#x63CF;&#x8FF0;&#x8A0A;&#x606F;&#x7684;&#x50B3;&#x905E;&#x3002;&#x751F;&#x7522;&#x8005;&#x8CA0;&#x8CAC;&#x7522;&#x751F;&#x8CC7;&#x6599;&#x4E26;&#x653E;&#x5728;&#x6709;&#x9650;&#x6216;&#x662F;&#x7121;&#x9650;&#x7684;&#x7DE9;&#x885D;&#x5340;&#x8B93;&#x7B49;&#x5F85;&#x6D88;&#x8CBB;&#x8005;&#x4F86;&#x8655;&#x7406;&#x3002;&#x4E32;&#x6D41;&#x8CC7;&#x6599;&#xFF08;Streaming Data&#xFF09;&#x672C;&#x8CEA;&#x4E0A;&#x5C31;&#x662F;&#x4E00;&#x7AEF;&#x4E0D;&#x65B7;&#x7684;&#x4E1F;&#x51FA;&#x8CC7;&#x6599;&#xFF0C;&#x53E6;&#x4E00;&#x7AEF;&#x9700;&#x8981;&#x6301;&#x7E8C;&#x5730;&#x9032;&#x884C;&#x8655;&#x7406;&#xFF0C;&#x5C31;&#x50CF; Producer-Consumer &#x4E00;&#x6A23;&#x3002;</p>
<!-- hexo-inject:begin --><!-- hexo-inject:end --><p>Kafka &#x662F;&#x8FD1;&#x671F;&#x4E00;&#x500B;&#x7528;&#x4F86;&#x8655;&#x7406;&#x4E32;&#x6D41;&#x8CC7;&#x6599;&#x7684;&#x71B1;&#x5011;&#x6846;&#x67B6;&#xFF0C;&#x5176;&#x6982;&#x5FF5;&#x7684;&#x793A;&#x610F;&#x5716;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="https://i.imgur.com/rueUNIq.jpg" alt="Imgur"></p>
<p>&#x63A5;&#x5230;&#x4E32;&#x6D41;&#x8CC7;&#x6599;&#x4E4B;&#x5F8C;&#x6211;&#x5011;&#x53EF;&#x4EE5;&#x642D;&#x914D; Spark &#x9032;&#x884C;&#x8655;&#x7406;&#xFF1A;</p>
<p><img src="https://i.imgur.com/WOLgtRW.png" alt="Imgur"></p>
<p>&#x4E32;&#x8D77;&#x4F86;&#x4E4B;&#x5F8C;&#xFF0C;&#x4E00;&#x500B;&#x5F88;&#x5178;&#x578B;&#x7684;&#x61C9;&#x7528;&#x5C31;&#x50CF;&#x9019;&#x6A23;&#xFF1A;</p>
<p><img src="https://i.imgur.com/6D4cvW1.png" alt="Imgur"></p>
<h3 id="kafka-&#x662F;&#x4EC0;&#x9EBC;"><a href="#Kafka-&#x662F;&#x4EC0;&#x9EBC;&#xFF1F;" class="headerlink" title="Kafka &#x662F;&#x4EC0;&#x9EBC;&#xFF1F;"></a>Kafka &#x662F;&#x4EC0;&#x9EBC;&#xFF1F;</h3><p>Kafka &#x662F;&#x7531; Apache &#x8EDF;&#x9AD4;&#x57FA;&#x91D1;&#x6703;&#x958B;&#x767C;&#x7684;&#x4E00;&#x500B;&#x958B;&#x6E90;&#x6D41;&#x8655;&#x7406;&#x5E73;&#x53F0;&#xFF0C;&#x76EE;&#x6A19;&#x662F;&#x70BA;&#x8655;&#x7406;&#x5373;&#x6642;&#x8CC7;&#x6599;&#x63D0;&#x4F9B;&#x4E00;&#x500B;&#x7D71;&#x4E00;&#x3001;&#x9AD8;&#x541E;&#x5410;&#x3001;&#x4F4E;&#x5EF6;&#x9072;&#x7684;&#x5E73;&#x53F0;&#x3002;&#x5176;&#x6301;&#x4E45;&#x5316;&#x5C64;&#x672C;&#x8CEA;&#x4E0A;&#x662F;&#x4E00;&#x500B;&#x300C;&#x6309;&#x7167;&#x5206;&#x6563;&#x5F0F;&#x4E8B;&#x52D9;&#x7D00;&#x9304;&#x6A94;&#x67B6;&#x69CB;&#x7684;&#x5927;&#x898F;&#x6A21;&#x767C;&#x5E03;&#x8A02;&#x95B1;&#x8A0A;&#x606F;&#x4F47;&#x5217;&#x300D;&#x3002;</p>
<p>&#x76F8;&#x95DC;&#x7684;&#x8853;&#x8A9E;&#x6709;&#xFF1A;</p>
<ul>
<li>Topic&#xFF1A;&#x7528;&#x4F86;&#x5C0D;&#x8A0A;&#x606F;&#x9032;&#x884C;&#x5206;&#x985E;&#xFF0C;&#x6BCF;&#x500B;&#x9032;&#x5165;&#x5230; Kafka &#x7684;&#x8CC7;&#x8A0A;&#x90FD;&#x6703;&#x88AB;&#x653E;&#x5230;&#x4E00;&#x500B; Topic &#x4E0B;</li>
<li>Broker&#xFF1A;&#x7528;&#x4F86;&#x5BE6;&#x73FE;&#x8CC7;&#x6599;&#x5132;&#x5B58;&#x7684;&#x4E3B;&#x6A5F;&#x4F3A;&#x670D;&#x5668;</li>
<li>Partition&#xFF1A;&#x6BCF;&#x500B; Topic &#x4E2D;&#x7684;&#x8A0A;&#x606F;&#x6703;&#x88AB;&#x5206;&#x70BA;&#x82E5;&#x5E72;&#x500B; Partition &#xFF0C;&#x4EE5;&#x63D0;&#x9AD8;&#x8A0A;&#x606F;&#x7684;&#x8655;&#x7406;&#x6548;&#x7387;</li>
</ul>
<p><img src="https://i.imgur.com/OVeqhSG.png" alt="Imgur"></p>
<h3 id="sparkpyspark-&#x662F;&#x4EC0;&#x9EBC;"><a href="#Spark-PySpark-&#x662F;&#x4EC0;&#x9EBC;&#xFF1F;" class="headerlink" title="Spark/PySpark &#x662F;&#x4EC0;&#x9EBC;&#xFF1F;"></a>Spark/PySpark &#x662F;&#x4EC0;&#x9EBC;&#xFF1F;</h3><p>Apache Spark &#x662F;&#x4E00;&#x500B;&#x5EF6;&#x4F38;&#x65BC; Hadoop MapReduce &#x7684;&#x958B;&#x6E90;&#x53E2;&#x96C6;&#x904B;&#x7B97;&#x6846;&#x67B6;&#xFF0C;Spark &#x4F7F;&#x7528;&#x4E86;&#x8A18;&#x61B6;&#x9AD4;&#x5167;&#x904B;&#x7B97;&#x6280;&#x8853;&#xFF0C;&#x80FD;&#x5728;&#x8CC7;&#x6599;&#x5C1A;&#x672A;&#x5BEB;&#x5165;&#x786C;&#x789F;&#x6642;&#x5373;&#x5728;&#x8A18;&#x61B6;&#x9AD4;&#x5167;&#x5206;&#x6790;&#x904B;&#x7B97;&#x3002;&#x7C21;&#x55AE;&#x4F86;&#x8AAA;&#x5C31;&#x662F;&#x4E00;&#x500B;&#x5229;&#x7528;&#x5206;&#x6563;&#x5F0F;&#x67B6;&#x69CB;&#x7684;&#x8CC7;&#x6599;&#x904B;&#x7B97;&#x5DE5;&#x5177;&#xFF0C;&#x5176;&#x4E3B;&#x8981;&#x7684;&#x904B;&#x7B97;&#x4E5F;&#x662F;&#x5229;&#x7528; Map - Reduce &#x7684; &#x904B;&#x7B97;&#x908F;&#x8F2F;&#x3002;Spark &#x539F;&#x672C;&#x662F;&#x7528; Java/Scala &#x505A;&#x958B;&#x767C;&#xFF0C;PySpark &#x662F;&#x4E00;&#x500B;&#x5C01;&#x88DD;&#x5F8C;&#x7684;&#x4ECB;&#x9762;&#xFF0C;&#x9069;&#x5408; Python &#x958B;&#x767C;&#x8005;&#x4F7F;&#x7528;&#x3002;</p>
<h2 id="&#x74B0;&#x5883;&#x6E96;&#x5099;"><a href="#&#x74B0;&#x5883;&#x6E96;&#x5099;" class="headerlink" title="&#x74B0;&#x5883;&#x6E96;&#x5099;"></a>&#x74B0;&#x5883;&#x6E96;&#x5099;</h2><ol>
<li>kafka + zookeeper</li>
</ol>
<p>&#x6211;&#x5011;&#x76F4;&#x63A5;&#x7528; brew kafka &#x6BD4;&#x8F03;&#x65B9;&#x4FBF;&#xFF0C;&#x5B89;&#x88DD;&#x4E4B;&#x5F8C;&#x518D;&#x5230;&#x8CC7;&#x6599;&#x593E;&#x4E2D;&#x78BA;&#x8A8D;&#x4F7F;&#x7528;&#x8A2D;&#x5B9A;&#x6A94;&#x90FD;&#x5B58;&#x5728;&#x3002;&#x9019;&#x908A;&#x53EF;&#x4EE5;&#x88DC;&#x5145;&#x4E00;&#x4E0B; ZooKeeper &#x662F;&#x4E00;&#x500B; Hadoop &#x7684;&#x5206;&#x6563;&#x5F0F;&#x8CC7;&#x6E90;&#x7BA1;&#x7406;&#x5DE5;&#x5177;&#xFF0C;kafka &#x4E5F;&#x53EF;&#x4EE5;&#x7528;&#x5B83;&#x4F86;&#x505A;&#x8CC7;&#x6E90;&#x7684;&#x7BA1;&#x7406;&#x8207;&#x5206;&#x914D;&#x3002;&#x5982;&#x679C;&#x76F4;&#x63A5;&#x7528; brew &#x5B89;&#x88DD;&#x7684;&#x8A71;&#xFF0C;zookeeper &#x4E5F;&#x6703;&#x4E00;&#x4F75;&#x5B89;&#x88DD;&#x3002;</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ brew install kafka </span><br><span class="line">$ ls /usr/<span class="built_in">local</span>/etc/kafka # kafka &#x8DDF; zookeeper &#x8A2D;&#x5B9A;&#x6A94;&#x6703;&#x653E;&#x5728;&#x6B64;&#x8CC7;&#x6599;&#x593E;&#x4E0B;</span><br><span class="line">connect-console-sink.<span class="built_in">properties</span>   consumer.<span class="built_in">properties</span></span><br><span class="line">connect-console-source.<span class="built_in">properties</span> log4j.<span class="built_in">properties</span></span><br><span class="line">connect-distributed.<span class="built_in">properties</span>    producer.<span class="built_in">properties</span></span><br><span class="line">connect-file-sink.<span class="built_in">properties</span>      server.<span class="built_in">properties</span></span><br><span class="line">connect-file-source.<span class="built_in">properties</span>    tools-log4j.<span class="built_in">properties</span></span><br><span class="line">connect-log4j.<span class="built_in">properties</span>          trogdor.conf</span><br><span class="line">connect-standalone.<span class="built_in">properties</span>     zookeeper.<span class="built_in">properties</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>PySpark</li>
</ol>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ pip install pyspark</span><br><span class="line">$ pyspark</span><br><span class="line">Welcome to</span><br><span class="line">      ____              <span class="symbol">__</span></span><br><span class="line">     / <span class="symbol">__</span>/<span class="symbol">__</span>  ___ _____/ /<span class="symbol">__</span></span><br><span class="line">    <span class="symbol">_</span>\ \/ <span class="symbol">_</span> \/ <span class="symbol">_</span> `/ <span class="symbol">__</span>/  &apos;<span class="symbol">_</span>/</span><br><span class="line">   /<span class="symbol">__</span> / .<span class="symbol">__</span>/\<span class="symbol">_</span>,<span class="symbol">_</span>/<span class="symbol">_</span>/ /<span class="symbol">_</span>/\<span class="symbol">_</span>\   version <span class="number">2.4</span><span class="number">.0</span></span><br><span class="line">      /<span class="symbol">_</span>/</span><br><span class="line"></span><br><span class="line">Using Python version <span class="number">3.5</span><span class="number">.2</span> (default, Nov <span class="number">30</span> <span class="number">2016</span> <span class="number">12</span>:<span class="number">41</span>:<span class="number">46</span>)</span><br><span class="line">SparkSession available as &apos;spark&apos;.</span><br></pre></td></tr></table></figure>
<p>&#x5982;&#x679C;&#x6709;&#x51FA;&#x73FE;&#x627E;&#x4E0D;&#x5230; SPARK_HOME &#x7684;&#x932F;&#x8AA4;&#x8A0A;&#x606F;&#xFF0C;&#x5728;&#x53E6;&#x5916;&#x8981;&#x914D;&#x7F6E;&#x4E00;&#x4E0B;&#x7684;&#x74B0;&#x5883;&#x8B8A;&#x6578;</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Could not find valid SPARK_HOME while searching</span></span><br><span class="line"><span class="comment"># [&apos;/home/user&apos;, &apos;/home/user/.local/bin&apos;]</span></span><br><span class="line"></span><br><span class="line">export PYSPARK_PYTHON=python3</span><br><span class="line">export SPARK_HOME=<span class="regexp">/Users/wei</span><span class="regexp">/Envs/py</span>3dev/<span class="class"><span class="keyword">lib</span>/<span class="title">python3</span>.5/<span class="title">site</span>-<span class="title">packages</span>/<span class="title">pyspark</span></span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>JAVA8</li>
</ol>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">brew </span>cask <span class="keyword">install </span><span class="keyword">java8</span></span><br><span class="line"><span class="keyword">$ </span><span class="keyword">java </span>-version</span><br><span class="line"><span class="keyword">java </span>version <span class="string">&quot;1.8.0_111&quot;</span></span><br><span class="line"><span class="keyword">Java(TM) </span>SE Runtime Environment (<span class="keyword">build </span><span class="number">1</span>.<span class="number">8</span>.<span class="number">0</span>_111-<span class="keyword">b14)</span></span><br><span class="line"><span class="keyword">Java </span>HotSpot(TM) <span class="number">64</span>-<span class="keyword">Bit </span>Server VM (<span class="keyword">build </span><span class="number">25</span>.<span class="number">111</span>-<span class="keyword">b14, </span>mixed mode)</span><br></pre></td></tr></table></figure>
<p>&#x53E6;&#x5916;&#x8981;&#x914D;&#x7F6E;&#x4E00;&#x4E0B; JAVA_HOME &#x7684;&#x74B0;&#x5883;&#x8B8A;&#x6578;</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">JAVA_HOME</span>=$(/usr/libexec/java_home -v 1.8)</span><br></pre></td></tr></table></figure>
<h2 id="workflow"><a href="#Workflow" class="headerlink" title="Workflow"></a>Workflow</h2><p>&#x24EA; &#x5148;&#x5207;&#x63DB;&#x5230; kafka &#x5B89;&#x88DD;&#x7684;&#x76EE;&#x9304;&#x4E0B;</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd <span class="regexp">/usr/</span>local<span class="regexp">/Cellar/</span>kafka<span class="regexp">/_________(&#x7248;&#x672C;&#x865F;)</span></span><br></pre></td></tr></table></figure>
<p>&#x2460; &#x555F;&#x52D5; zookeeper &#x670D;&#x52D9;&#xFF08;<strong>&#x9700;&#x8981;&#x9577;&#x99D0;&#x57F7;&#x884C;&#x5728;&#x80CC;&#x666F;</strong>&#xFF09;</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.<span class="regexp">/bin/</span>zookeeper-server-start <span class="regexp">/usr/</span>local<span class="regexp">/etc/</span>kafka<span class="regexp">/zookeeper.properties</span></span><br></pre></td></tr></table></figure>
<p>&#x2461; &#x555F;&#x52D5; kafka &#x670D;&#x52D9;&#xFF08;<strong>&#x9700;&#x8981;&#x9577;&#x99D0;&#x57F7;&#x884C;&#x5728;&#x80CC;&#x666F;</strong>&#xFF09;</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.<span class="regexp">/bin/</span>kafka-server-start <span class="regexp">/usr/</span>local<span class="regexp">/etc/</span>kafka<span class="regexp">/server.properties</span></span><br></pre></td></tr></table></figure>
<p>&#x2462; &#x5275;&#x5EFA;/&#x67E5;&#x770B; Topic</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x5EFA;&#x4E00;&#x500B;&#x540D;&#x70BA; test-kafka &#x7684; Topic</span></span><br><span class="line"><span class="string">./bin/kafka-topics</span> <span class="params">--create</span> <span class="params">--zookeeper</span> localhost<span class="function">:2181</span> <span class="params">--replication-factor</span> 1 <span class="params">--partitions</span> 1 <span class="params">--topic</span> test-kafka</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x67E5;&#x770B;&#x76EE;&#x524D;&#x5DF2;&#x7D93;&#x5EFA;&#x7ACB;&#x904E;&#x7684; Topic</span></span><br><span class="line"><span class="string">./bin/kafka-topics</span> <span class="params">--list</span> <span class="params">--zookeeper</span> localhost<span class="function">:2181</span>\n\n</span><br></pre></td></tr></table></figure>
<h2 id="streaming-data"><a href="#Streaming-Data" class="headerlink" title="Streaming Data"></a>Streaming Data</h2><p>&#x7522;&#x751F;&#x8207;&#x63A5;&#x6536;&#x4E32;&#x6D41;&#x8CC7;&#x6599;&#x7684;&#x65B9;&#x6CD5;&#x6709;&#x4E09;&#x7A2E;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; kafka-console &#x6307;&#x4EE4;&#x3001;kafka-python &#x5957;&#x4EF6;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; PySpark &#x4F86;&#x8655;&#xFF0C;&#x4EE5;&#x4E0B;&#x793A;&#x7BC4;&#x7C21;&#x55AE;&#x7684;&#x7A0B;&#x5F0F;&#x78BC;&#xFF1A;</p>
<h3 id="kafka-console"><a href="#kafka-console" class="headerlink" title="kafka-console"></a>kafka-console</h3><p>&#x2460; Producer</p>
<p>&#x4F7F;&#x7528;&#x6307;&#x4EE4;(kafka-console-producer)&#x7522;&#x751F;&#x4E32;&#x6D41;&#x8CC7;&#x6599;&#x5230;&#x7279;&#x5B9A;&#x7684; Topic</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="string">./bin/kafka-console-producer</span> <span class="params">--broker-list</span> localhost<span class="function">:9092</span> <span class="params">--topic</span> test-kafka</span><br></pre></td></tr></table></figure>
<p>&#x2461; Costomer</p>
<p>&#x4F7F;&#x7528;&#x6307;&#x4EE4;(kafka-console-consumer)&#x5F9E;&#x7279;&#x5B9A;&#x7684; Topic &#x63A5;&#x6536;&#x4E32;&#x6D41;&#x8CC7;&#x6599;</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="string">./bin/kafka-console-consumer</span> <span class="params">--bootstrap-server</span> localhost<span class="function">:9092</span> <span class="params">--topic</span> test-kafka <span class="params">--from-beginning</span></span><br></pre></td></tr></table></figure>
<h3 id="kafka-python"><a href="#kafka-python" class="headerlink" title="kafka-python"></a>kafka-python</h3><p>&#x2460; Producer</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">from</span> kafka import KafkaProducer</span><br><span class="line">import <span class="built_in">time</span></span><br><span class="line"></span><br><span class="line">brokers, topic = <span class="string">&apos;localhost:9092&apos;</span>, <span class="string">&apos;test-kafka&apos;</span></span><br><span class="line"></span><br><span class="line">def <span class="built_in">start</span>():</span><br><span class="line">    <span class="keyword">while</span> True:</span><br><span class="line">        print(<span class="string">&quot; --- produce ---&quot;</span>)</span><br><span class="line">        <span class="built_in">time</span>.sleep(<span class="number">10</span>)</span><br><span class="line">        producer.<span class="built_in">send</span>(<span class="string">&apos;topic&apos;</span>, key=b<span class="string">&apos;foo&apos;</span>, <span class="built_in">value</span>=b<span class="string">&apos;bar&apos;</span>)</span><br><span class="line">        producer.flush()</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&apos;__main__&apos;</span>:</span><br><span class="line">    producer = KafkaProducer(bootstrap_servers=brokers)</span><br><span class="line">    <span class="built_in">start</span>()</span><br><span class="line">    producer.<span class="built_in">close</span>()</span><br></pre></td></tr></table></figure>
<p>&#x57F7;&#x884C;&#xFF1A;</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">python</span> kafka-producer.<span class="keyword">py</span></span><br></pre></td></tr></table></figure>
<p>&#x2461; Costomer</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> kafka import KafkaConsumer</span><br><span class="line"></span><br><span class="line">brokers, topic = <span class="string">&apos;localhost:9092&apos;</span>, <span class="string">&apos;test-kafka&apos;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&apos;__main__&apos;</span>:</span><br><span class="line">  consumer = KafkaConsumer(topic, <span class="attribute">group_id</span>=<span class="string">&apos;test-consumer-group&apos;</span>, bootstrap_servers=[brokers])</span><br><span class="line">  <span class="keyword">for</span> msg <span class="keyword">in</span> consumer:</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">&quot;key=%s, value=%s&quot;</span> % (msg.key, msg.value))</span><br></pre></td></tr></table></figure>
<p>&#x57F7;&#x884C;&#xFF1A;</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">python</span> kafka-costomer.<span class="keyword">py</span></span><br></pre></td></tr></table></figure>
<h3 id="pyspark"><a href="#PySpark" class="headerlink" title="PySpark"></a>PySpark</h3><p>&#x2460; Costomer</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">import</span> sys</span><br><span class="line">from pyspark <span class="built_in">import</span> SparkContext</span><br><span class="line">from pyspark.streaming <span class="built_in">import</span> StreamingContext</span><br><span class="line">from pyspark.streaming.kafka <span class="built_in">import</span> KafkaUtils</span><br><span class="line"></span><br><span class="line">brokers, <span class="attr">topic</span> = &apos;localhost:<span class="number">9092</span>&apos;, &apos;test-kafka&apos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="attr">__name__</span> == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="attr">sc</span> = SparkContext(<span class="attr">appName=&quot;PythonStreamingDirectKafkaWordCount&quot;)</span></span><br><span class="line">    <span class="attr">ssc</span> = StreamingContext(sc, <span class="number">10</span>)</span><br><span class="line">    <span class="attr">kvs</span> = KafkaUtils.createDirectStream(ssc, [topic], {<span class="string">&quot;metadata.broker.list&quot;</span>: brokers})</span><br><span class="line">    <span class="attr">lines</span> = kvs.<span class="built_in">map</span>(lambda x: x[<span class="number">1</span>])</span><br><span class="line">    <span class="attr">counts</span> = lines.flatMap(lambda line: line.split(<span class="string">&quot; &quot;</span>))</span><br><span class="line">    ssc.start()</span><br><span class="line">    ssc.awaitTermination()</span><br></pre></td></tr></table></figure>
<p>&#x57F7;&#x884C; pyspark &#x7684;&#x57F7;&#x884C;&#x8981;&#x7528; spark-submit &#x6307;&#x4EE4;&#xFF0C;&#x800C;&#x4E14;&#x8981;&#x52A0;&#x4E0A; kafka &#x7684;&#x914D;&#x7F6E;&#x6A94;<br>&#xFF08;&#x6240;&#x4EE5;&#x8981;&#x5728;&#x540C;&#x76EE;&#x9304;&#x4E0B;&#x4E0B;&#x8F09; spark-streaming-kafka-0-8-assembly_2.11-2.1.0.jar &#x914D;&#x7F6E;&#x6A94;&#xFF09;</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ spark-submit --jars spark-streaming-kafka<span class="number">-0</span><span class="number">-8</span>-assembly_2<span class="number">.11</span><span class="number">-2.1</span><span class="number">.0</span>.jar pyspark-consumer.py</span><br></pre></td></tr></table></figure>
<h3 id="connect-producer-costomer"><a href="#Connect-Producer-amp-Costomer" class="headerlink" title="Connect Producer &amp; Costomer"></a>Connect Producer &amp; Costomer</h3><p>&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x4EE5;&#x4E0A;&#x4E0D;&#x540C;&#x7684; Producer &#x65B9;&#x6CD5;&#x5C0D;&#x540C;&#x4E00;&#x500B; topic &#x767C;&#x9001;&#x8A0A;&#x606F;&#xFF0C;&#x7136;&#x5F8C;&#x7528; Costomer &#x7684;&#x65B9;&#x6CD5;&#x4F86;&#x63A5;&#x6536;&#xFF01;</p>
<h2 id="&#x5C0F;&#x7D50;"><a href="#&#x5C0F;&#x7D50;" class="headerlink" title="&#x5C0F;&#x7D50;"></a>&#x5C0F;&#x7D50;</h2><p>&#x672C;&#x7CFB;&#x5217;&#x9810;&#x8A08;&#x6703;&#x6709;&#x4E09;&#x7BC7;&#x6587;&#x7AE0;&#xFF0C;&#x628A;&#x4E00;&#x500B;&#x4E32;&#x6D41;&#x8CC7;&#x6599;&#x5F9E;&#x4F86;&#x6E90;&#x5230;&#x8CC7;&#x6599;&#x5EAB;&#x7684;&#x904E;&#x7A0B;&#x8D70;&#x904E;&#x4E00;&#x6B21;&#xFF1A;</p>
<ul>
<li><a href="/2019/03/27/&#x5728;-mac-&#x4E0A;&#x5EFA;&#x7ACB;-Python-&#x7684;-Kafka-&#x8207;-Spark-&#x74B0;&#x5883;/">&#x5728; mac &#x4E0A;&#x5EFA;&#x7ACB; Python &#x7684; Kafka &#x8207; Spark &#x74B0;&#x5883;</a> &lt;- &#x672C;&#x7BC7;</li>
<li>Kafka &#x4E32;&#x63A5; Twitter Streaming API</li>
<li>Spark &#x63A5;&#x6536; Kafka &#x8CC7;&#x6599;&#x5F8C;&#x5132;&#x5B58;</li>
</ul>
<h2 id="reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p>[1] <a href="https://blog.csdn.net/qq_36330643/article/details/84639695" target="_blank" rel="noopener">mac&#x4E0B;kafka&#x73AF;&#x5883;&#x642D;&#x5EFA;&#x6D4B;&#x8BD5;</a><br>[2] <a href="https://louis925.wordpress.com/2018/07/05/%E7%94%A8-pip-%E5%9C%A8-macos-%E4%B8%8A%E5%AE%89%E8%A3%9D%E5%96%AE%E6%A9%9F%E4%BD%BF%E7%94%A8%E7%9A%84-pyspark/" target="_blank" rel="noopener">&#x7528; pip &#x5728; macOS &#x4E0A;&#x5B89;&#x88DD;&#x55AE;&#x6A5F;&#x4F7F;&#x7528;&#x7684; pyspark</a><br>[3] <a href="https://stackoverflow.com/questions/1348842/what-should-i-set-java-home-to-on-osx?noredirect=1&amp;lq=1" target="_blank" rel="noopener">What should I set JAVA_HOME to on OSX</a><br>[4] <a href="https://stackoverflow.com/questions/46286436/running-pyspark-after-pip-install-pyspark/49587560" target="_blank" rel="noopener">Running pyspark after pip install pyspark</a><br>[5] <a href="https://medium.com/@mukeshkumar_46704/getting-streaming-data-from-kafka-with-spark-streaming-using-python-9cd0922fa904" target="_blank" rel="noopener">Getting Streaming data from Kafka with Spark Streaming using Python.</a></p>
<hr>
<h2 id="license"><a href="#License" class="headerlink" title="License"></a>License</h2><p><img src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png" style="    margin: 0;"><br>&#x672C;&#x8457;&#x4F5C;&#x7531;<a href="https://www.facebook.com/v123582" target="_blank" rel="noopener"> Chang, Wei-Yaun (v123582) </a>&#x88FD;&#x4F5C;&#xFF0C;<br>&#x4EE5;<a href="http://creativecommons.org/licenses/by-sa/3.0/deed.zh_TW" target="_blank" rel="noopener">&#x5275;&#x7528;CC &#x59D3;&#x540D;&#x6A19;&#x793A;-&#x76F8;&#x540C;&#x65B9;&#x5F0F;&#x5206;&#x4EAB; 3.0 Unported</a>&#x6388;&#x6B0A;&#x689D;&#x6B3E;&#x91CB;&#x51FA;&#x3002;</p>
</div><div class="post-nav"><a href="/2019/04/08/讓-Spark-接上-MongoDB/" class="pre"><i class="icon-previous">讓 Spark 接上 MongoDB 儲存資料</i></a><a href="/2019/01/20/K-means-怎麼選-K/" class="next">K-means 怎麼選 K ?<i class="icon-next"></i></a></div><div id="disqus_thread"><script>var disqus_shortname = 'v123582';
var disqus_identifier = '2019/03/27/在-mac-上建立-Python-的-Kafka-與-Spark-環境/';
var disqus_title = '在 mac 上建立 Python 的 Kafka 與 Spark 環境';
var disqus_url = 'https://blog.v12358.tw/2019/03/27/在-mac-上建立-Python-的-Kafka-與-Spark-環境/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//v123582.disqus.com/count.js" async="async"></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><div class="widget-title">Information</div><ul><div class="tags">標籤：<a href="/tags/環境設定筆記/">環境設定筆記 </a><a href="/tags/資料工程系列/">資料工程系列 </a><a href="/tags/kafka/">kafka </a><a href="/tags/pyspark/">pyspark </a><a href="/tags/spark/">spark </a></div><div class="categories">分類：<a href="/categories/Data-Science/">Data Science</a></div></ul></div><div class="widget"><div class="widget-title">Table of Content</div><div class="clear"><div id="toc" class="toc-article"><div class="toc"></div></div></div></div><script type="text/javascript" src="//js1.bloggerads.net/ShowAds.aspx?blogid=20190326000001" async></script></div></div></div><div id="footer">© <a href="/" rel="nofollow">資料科學家的工作日常.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div><script src="/js/jquery.min.js"></script>
<script src="/js/share.js"></script><script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><a id="rocket" href="#top" class="show"></a><script src="/js/jquery.min.js"></script>
<script src="/js/totop.js"></script><script src="/js/fancybox.pack.js"></script>
<script src="/js/jquery.fancybox.js"></script><link rel="stylesheet" href="/css/jquery.fancybox.css"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-59103909-1','auto');ga('send','pageview');
</script></div><!-- hexo-inject:begin --><!-- hexo-inject:end --></body></html>